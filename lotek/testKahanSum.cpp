/*
    Copyright 2014 John Brzustowski

    Licence: GPL version 2 or later

    Test the KahanSum class.
    
    ## test with 'float'

     echo 1e8 1 1 1 1 1 1 1 1 1 1 -10 | ./testKahanSum float
100000000 100000000 -100000000
100000000 100000000 -100000000
100000000 100000000 -100000000
100000000 100000000 -100000000
100000000 100000000 -100000000
100000000 100000008 -100000008
100000000 100000008 -100000008
100000000 100000008 -100000008
100000000 100000008 -100000008
100000000 100000008 -100000008
100000000 100000008 -100000008
99999992 100000000 -100000000

    ## test with 'double'
 
    echo 1e17  1 1 1 1 1 1 1 1 1 1 -10 | ./testKahanSum double
100000000000000000 100000000000000000 -100000000000000000
100000000000000000 100000000000000000 -100000000000000000
100000000000000000 100000000000000000 -100000000000000000
100000000000000000 100000000000000000 -100000000000000000
100000000000000000 100000000000000000 -100000000000000000
100000000000000000 100000000000000000 -100000000000000000
100000000000000000 100000000000000000 -100000000000000000
100000000000000000 100000000000000000 -100000000000000000
100000000000000000 100000000000000000 -100000000000000000
100000000000000000 100000000000000016 -100000000000000016
100000000000000000 100000000000000016 -100000000000000016
99999999999999984 100000000000000000 -100000000000000000

    ## test with 'longdouble'

 echo 1e20  1 1 1 1 1 1 1 1 1 1 -10 | ./testKahanSum longdouble
100000000000000000000 100000000000000000000 -100000000000000000000
100000000000000000000 100000000000000000000 -100000000000000000000
100000000000000000000 100000000000000000000 -100000000000000000000
100000000000000000000 100000000000000000000 -100000000000000000000
100000000000000000000 100000000000000000000 -100000000000000000000
100000000000000000000 100000000000000000008 -100000000000000000008
100000000000000000000 100000000000000000008 -100000000000000000008
100000000000000000000 100000000000000000008 -100000000000000000008
100000000000000000000 100000000000000000008 -100000000000000000008
100000000000000000000 100000000000000000008 -100000000000000000008
100000000000000000000 100000000000000000008 -100000000000000000008
99999999999999999992 100000000000000000000 -100000000000000000000

    Reference: http://en.wikipedia.org/wiki/Kahan_summation

*/

#include <iostream>
#include <iomanip>
#include "KahanSum.h"

template < typename DATATYPE > 

void dotest(DATATYPE ignore) {
  DATATYPE s = 0.0;
  KahanSum < DATATYPE > ks;
  KahanSum < DATATYPE > ksm;
  DATATYPE x;

  std::cout << std::setprecision(24);
  for (;;) {
    std::cin >> x;
    if (std::cin.eof()) 
      break;
    s += x;
    ks += x;
    ksm -= x;

    std::cout << s << ' ' << ks << ' ' << ksm << std::endl;
  };

}

main (int argc, char * argv[]) {
  std::string type;
  if (argc != 2) {
    std::cerr << "Usage: testKahanSum float|double|longdouble";
  } else {
    type = argv[1];
    if (type == "double")
      dotest ((double) 0.0);
    else if (type == "longdouble")
      dotest ((long double) 0.0);
    else
      dotest ((float) 0.0);
  }
};

