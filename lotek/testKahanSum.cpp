/*
    Copyright 2014 John Brzustowski

    Licence: GPL version 2 or later

    Test the KahanSum class.
    
    ## test with 'float'

     echo 1 1 1 1 1 1 1 1 1 1 -10 | ./testKahanSum float 1e8
100000000 100000000 100000000
100000000 100000000 100000000
100000000 100000000 100000000
100000000 100000000 100000000
100000000 100000008 99999992
100000000 100000008 99999992
100000000 100000008 99999992
100000000 100000008 99999992
100000000 100000008 99999992
100000000 100000008 99999992
99999992 100000000 100000000

    ## test with 'double'
 
    echo 1 1 1 1 1 1 1 1 1 1 -10 | ./testKahanSum double 1e17
100000000000000000 100000000000000000 100000000000000000
100000000000000000 100000000000000000 100000000000000000
100000000000000000 100000000000000000 100000000000000000
100000000000000000 100000000000000000 100000000000000000
100000000000000000 100000000000000000 100000000000000000
100000000000000000 100000000000000000 100000000000000000
100000000000000000 100000000000000000 100000000000000000
100000000000000000 100000000000000000 100000000000000000
100000000000000000 100000000000000016 99999999999999984
100000000000000000 100000000000000016 99999999999999984
99999999999999984 100000000000000000 100000000000000000

    ## test with 'longdouble'

 echo 1 1 1 1 1 1 1 1 1 1 -10 | ./testKahanSum longdouble 1e20
100000000000000000000 100000000000000000000 100000000000000000000
100000000000000000000 100000000000000000000 100000000000000000000
100000000000000000000 100000000000000000000 100000000000000000000
100000000000000000000 100000000000000000000 100000000000000000000
100000000000000000000 100000000000000000008 99999999999999999992
100000000000000000000 100000000000000000008 99999999999999999992
100000000000000000000 100000000000000000008 99999999999999999992
100000000000000000000 100000000000000000008 99999999999999999992
100000000000000000000 100000000000000000008 99999999999999999992
100000000000000000000 100000000000000000008 99999999999999999992
99999999999999999992 100000000000000000000 100000000000000000000

    Reference: http://en.wikipedia.org/wiki/Kahan_summation

*/

#include <iostream>
#include <iomanip>
#include <sstream>
#include "KahanSum.h"

template < typename DATATYPE > 

void dotest(DATATYPE initial) {
  DATATYPE s = initial;
  KahanSum < DATATYPE > ks (initial);
  KahanSum < DATATYPE > ksm (initial);
  DATATYPE x;

  std::cout << std::setprecision(24);
  for (;;) {
    std::cin >> x;
    if (std::cin.eof()) 
      break;
    s += x;
    ks += x;
    ksm -= x;

    std::cout << s << ' ' << ks << ' ' << ksm << std::endl;
  };

}

int
main (int argc, char * argv[]) {
  std::string type;
  long double initial = 0.0;
  if (argc < 2) {
    std::cerr << "Usage: testKahanSum float|double|longdouble [INITIAL]";
  } else {
    type = argv[1];
    if (argc > 2) {
      std::istringstream is(argv[2]);
      is >> initial;
    }
    if (type == "double")
      dotest ((double) initial);
    else if (type == "longdouble")
      dotest ((long double) initial);
    else
      dotest ((float) initial);
  }
};

